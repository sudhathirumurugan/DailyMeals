<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback - arieoMeals</title>
    <%= stylesheet_link_tag "Feedback", media: "all" %>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <%= javascript_importmap_tags %>
</head>
<body>

    <div class="container">
        <div>
            <%= render 'shared/employee/sidebar' %>
        </div>
        
        <div class="main-content">
            <h2>Your feedback matters</h2>
            <p class="notice" style="color: green;"><%= notice %></p>
            <p class="alert" style="color: red;"><%= alert %></p>
            
            <div class="feedback-container">
                <div class="feedback-header">
                    <span>Give your feedback</span>
                    <span class="feedback-date"><%= Date.today.strftime("%B %d, %A %Y") %></span>
                </div>

                <%= form_with model: @feedback, url: employee_feedbacks_path, method: :post, local: true do |f| %>
                    <div class="rating-section">
                        <div class="rating-item">
                            <%= f.label :rating_for_snack, "Snack Rating", class: "rating-label" %>
                        
                            <div class="stars" data-field="<%= "#{f.object_name}_rating_for_snack" %>">
                                <% (1..5).each do |i| %>
                                    <span class="star" data-value="<%= i %>">&#9734;</span>
                                <% end %>
                            </div>
                        
                            <!-- Hidden field to store the float rating -->
                            <%= f.hidden_field :rating_for_snack, id: "#{f.object_name}_rating_for_snack", value: f.object.rating_for_snack || 0 %>
                        </div>
                  
                        <div class="rating-item">
                                <%= f.label :rating_for_dinner, "Dinner Rating", class: "rating-label" %>
                            
                                <div class="stars" data-field="<%= "#{f.object_name}_rating_for_dinner" %>">
                                    <% (1..5).each do |i| %>
                                        <span class="star" data-value="<%= i %>">&#9734;</span>
                                    <% end %>
                                </div>
                            
                                <%= f.hidden_field :rating_for_dinner, id: "#{f.object_name}_rating_for_dinner", value: f.object.rating_for_dinner || 0 %>
                        </div>
                        
                    </div>

                        <div class="comment-section">
                            <%= f.label :comments_for_dinner, "Your comments" %>
                            <%= f.text_area :comments_for_dinner, placeholder: "Enter your comments" %>
                        </div>                 

                        <div class="submit-btn-wrapper">
                            <%= f.submit "Submit", class: "submit-btn" %>
                        </div>
                <% end %>
            </div>
        </div>
    </div>

</body>
<script>
document.addEventListener("DOMContentLoaded", function () {
    function initializeRating() {
        document.querySelectorAll(".stars").forEach(container => {
            let stars = container.querySelectorAll(".star");
            let hiddenInput = document.getElementById(container.dataset.field); // Hidden field selection

            stars.forEach((star, index) => {
                star.addEventListener("click", function (event) {
                    let clickPosition = event.offsetX / star.offsetWidth;
                    let isHalf = clickPosition < 1;
                    let newRating = index + 1;

                    hiddenInput.value = newRating; // Store float value (e.g., 3.5)
                    updateStars(stars, newRating);
                });

                star.addEventListener("mouseover", function (event) {
                    let hoverIndex = index + (event.offsetX < star.offsetWidth / 2 ? 1 : 1);
                    updateStars(stars, hoverIndex);
                });

                container.addEventListener("mouseleave", function () {
                    updateStars(stars, parseFloat(hiddenInput.value)); // Restore saved rating
                });
            });

            // Restore stars from previously selected value
            let savedRating = parseFloat(hiddenInput.value);
            if (!isNaN(savedRating) && savedRating > 0) {
                updateStars(stars, savedRating);
            }
        });
    }

    function updateStars(stars, rating) {
        stars.forEach((star, i) => {
            if (i + 1 <= rating) {
                star.innerHTML = "&#9733;"; // Full star
                star.classList.add("checked");
            } else if (i + 0.5 <= rating) {
                star.innerHTML = "&#189;"; // Half star
                star.classList.add("checked-half");
            } else {
                star.innerHTML = "&#9734;"; // Empty star
                star.classList.remove("checked", "checked-half");
            }
        });
    }

    initializeRating();
});

</script>
</html>


