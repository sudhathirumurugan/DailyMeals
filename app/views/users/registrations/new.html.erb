<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register - arieoMeals</title>
    <meta name="csrf-token" content="<%= csrf_meta_tags %>">
    <%= stylesheet_link_tag "Register", media: "all" %>
</head>
<body style="background: url('<%= asset_path('Food.jpg') %>') no-repeat center center/cover;">
    <div class="register-popup">
      <p id="emailr-error"></p>
      <p id="passwordr-error"></p>
      <p id="password-confirm-error"></p>
    </div>
    <div class="wrapper">
        <div class="glass-box"></div>
        <div class="container">

            <div id="flash-popup" class="flash-popup" style="display: none;">
                <span id="flash-message"></span>
            </div>
            <%#%>
            
            <div class="left-box">
                <h2 class="brand">arieoMeals</h2>
                <%= image_tag "chef.png", alt: "arieoMeals img", class: "transparent-img" %>
            </div>
            <div class="register-box">
                <h2>Register</h2>
                <p class="notice"><%= notice %></p>
                <p class="alert"><%= alert %></p>
                <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { id: "signup-form" }) do |f| %>
                <%= render "users/shared/error_messages", resource: resource %>
                     <label for="name">Name</label>
                    <%= f.text_field :name, id: "name", placeholder: "Enter your Name", required: true, maxlength: 30, minlength: 3 %>

                    <label for="email">Email</label>
                    <%= f.email_field :email, id: "email", placeholder: "Enter your email", required: true, minlength: 6, maxlength: 30 %>

                    <label for="password">Password</label>
                    <div class="password-wrapper">
                        <%= f.password_field :password, id: "password", placeholder: "Enter your password", required: true, minlength: 8, maxlength: 30 %>
                    </div>

                    <label for="confirm-password">Re-Enter Password</label>
                    <div class="password-wrapper">
                        <%= f.password_field :password_confirmation, id: "re-enter-password", placeholder: "Re-Enter your password", required: true, minlength: 8, maxlength: 30 %>
                    </div>
                    
                    <div class="actions">
                        <%= f.submit "Register", class: "btn" %>
                    </div>
                <% end %>

                <p class="or-text">or</p>
                <p class="login-text">Already have an account? <%= link_to "Login Here", new_session_path(resource_name) %></p>
            </div>
        </div>
    </div>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const form1 = document.querySelector("#signup-form");
            if (!form1) return;

            const emailInput1 = document.querySelector("#email");
            const passwordInput1 = document.querySelector("#password");
            const confirmPasswordInput1 = document.querySelector("#re-enter-password"); // FIXED ID
            const emailError1 = document.querySelector("#emailr-error");
            const passwordError1 = document.querySelector("#passwordr-error");
            const confirmPasswordError1 = document.querySelector("#password-confirm-error");
            const registerPopup = document.querySelector(".register-popup");

        form1.addEventListener("submit", function (event) {
            let isValid = true;
            registerPopup.style.display = "none"; 
            registerPopup.style.opacity = "0"; 

            const emailPattern1 = /^[a-zA-Z0-9._%+-]+@gmail\.com$/;
            if (!emailPattern1.test(emailInput1.value)) {
                emailError1.textContent = "Please enter a valid Gmail address.";
                isValid = false;
            } else {
                emailError1.textContent = "";
            }

            const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,}$/;
            if (!passwordPattern.test(passwordInput1.value)) {
                passwordError1.textContent = "Password must have uppercase, lowercase, number, and special character.";
                isValid = false;
            } else {
                passwordError1.textContent = "";
            }

            if (confirmPasswordInput1.value !== passwordInput1.value) {
                confirmPasswordError1.textContent = "Passwords do not match!";
                isValid = false;
            } else {
                confirmPasswordError1.textContent = "";
            }

            if (!isValid) {
                registerPopup.style.display = "block"; 
                setTimeout(() => {
                    registerPopup.style.opacity = "1"; 
                }, 100);

            setTimeout(() => {
                let opacityValue = 1.0; // Start fully visible
                let fadeEffect = setInterval(() => {
                    if (opacityValue > 0) {
                        opacityValue -= 0.1; // Reduce opacity
                        registerPopup.style.opacity = opacityValue.toString();
                    } else {
                        clearInterval(fadeEffect);
                        registerPopup.style.display = "none"; 
                    }
                }, 100);
            }, 4000); // Fade-out after 4 sec

            event.preventDefault(); // Stop form submission
            }
            });
        });

    </script>
</body>
</html>

